/** @preserve
 sspxml version 1.0 - xml-editor and/or xml-prettyfier as jQuery-plugin; 
 Author: Tilman Sandig, Sandig Software Productions GmbH, Germany; 
 You must buy a license for sspxml, if you want to use it in your own projects; for further information see https://www.sandig.com/software/javascript/sspxml.html
*/
!function($,piName){var cursorKeys=[35,36,37,38,39,40],supportedNT=[1,3,4,7,8,9,11],containerNT=[1,9,11],rexLeadWhiteSpace=/^[\n\r\t ]+/,rexTrailWhiteSpace=/[\n\r\t ]+$/,rexOnlyWhiteSpace=/^[\n\r\t ]*$/,checkXmlSupported=function(n){var nt=n.nodeType;if($.inArray(nt,supportedNT)==-1)throw new Error("sspxml: xml contains unsupported nodetype ["+nt+"]");if($.inArray(nt,containerNT)!=-1)for(var nl=n.childNodes,l=nl.length,i=0;i<l;i++)checkXmlSupported(nl[i])},xmlChar=function(c,isAtt){if("&"==c)return"&amp;";if("<"==c)return"&lt;";if(">"==c)return"&gt;";if(isAtt){if('"'==c)return"&quot;";if("\n"==c)return"&#10;"}var cc=c.charCodeAt(0);return cc<32&&10!=cc||160==cc?"&#"+cc+";":c},getSepTextNodes=function(xml,separator,includeCDATA){var txt=separator,procNodes=function(n){if($.inArray(n.nodeType,containerNT)!=-1)for(var l=n.childNodes.length,i=0;i<l;i++)procNodes(n.childNodes[i]);else if(3==n.nodeType||includeCDATA===!0&&4==n.nodeType){var entry=$.trim(n.nodeValue.replace(/\n/g," "))+separator;txt.indexOf(separator+entry)==-1&&(txt+=entry)}};return procNodes(xml),txt.substring(separator.length,txt.length-separator.length)},formatXml=function(xml,childrenOnly){var txt="",resolveEnt=function(s,isAtt){for(var t="",i=0;i<s.length;i++)t+=xmlChar(s[i],isAtt);return $.trim(t)},appendNode=function(n,indent,lenParList){var nt=n.nodeType,nn=n.nodeName,nv=n.nodeValue;if(1==nt){var atts=n.attributes,chl=n.childNodes.length,shorty=1==chl&&3==n.childNodes[0].nodeType&&$.trim(n.childNodes[0].nodeValue).length<40&&$.trim(n.childNodes[0].nodeValue).indexOf("\n")==-1;txt+=indent+"<"+nn;for(var a=0;a<atts.length;a++)txt+=" "+atts[a].nodeName+'="'+resolveEnt(atts[a].value,!0)+'"';0==chl?txt+="/>\n":(txt+=">",shorty||(txt+="\n"),appendNodeList(n.childNodes,shorty?"":indent+"    "),shorty||(txt+=indent),txt+="</"+nn+">\n")}else if(3==nt){var t=resolveEnt(nv,!1);if(""!=t){var shorty=1==lenParList&&$.trim(nv).length<40&&t.indexOf("\n")==-1;shorty||(t=t.replace(/\n/g,"\n"+indent)),txt+=indent+t,shorty||(txt+="\n")}}else 4==nt?txt+=indent+"<![CDATA["+nv+"]]>\n":7==nt?txt+=indent+"<?"+nn+" "+nv+" ?>\n":8==nt&&(txt+=indent+"<!-- "+nv+" -->\n")},appendNodeList=function(nl,indent){for(var l=nl.length,i=0;i<l;i++)appendNode(nl[i],indent,l)};return checkXmlSupported(xml),9==xml.nodeType||11==xml.nodeType||childrenOnly===!0?appendNodeList(xml.childNodes,""):appendNode(xml,"",1),txt},slktr={clk:".elename, .attrib, .xbo, .xbi, .xbc, .attsep, .attval, .attquot, .commentval, .commentmarkup, .textnode, .cdataval, .cdatamarkup, .pimarkup, .piname, .pival, .emptyclose",mu:".elename, .attrib, .attval, .commentval, .textnode, .cdataval, .piname, .pival"},onExpandButton=function(){var eb=$(this);return eb.toggleClass("button-expand button-collapse"),eb.next().toggleClass("collapsed"),!1},toggleExpand=function(elem){elem.toggleClass("collapsed"),elem.prev().toggleClass("button-expand button-collapse")},txt=function(s){return $("<span/>").text(s)},span=function(s,c){return $("<span/>").text(s).addClass(c)},tspan=function(s,c){return $("<span/>").addClass(c).append(span(s,"text"))},resEnt=function(q,s){for(var tn="",isAtt=q.hasClass("attval"),ent=function(q,e){""!=tn&&(q.append(span(tn,"text")),tn=""),q.append(span(e,"xentity"))},i=0;i<s.length;i++){var c=xmlChar(s[i],isAtt);c!=s[i]?ent(q,c):tn+=c}return""!=tn&&q.append(span(tn,"text")),q},getSelectedText=function(){var t="";if(window.getSelection){var s=window.getSelection();s.rangeCount>0&&(t=s.getRangeAt(0).toString())}else document.selection&&"Control"!=document.selection.type&&(t=document.selection.createRange().text);return t.replace(/\r/g,"")},removeSelections=function(){if(window.getSelection){var s=window.getSelection();s.removeAllRanges&&s.rangeCount>0?s.removeAllRanges():s.empty&&s.empty()}else document.selection&&document.selection.empty()},getSelPos=function(element,start){var sel,doc=element.ownerDocument||element.document,win=doc.defaultView||doc.parentWindow,spcr="";if("undefined"!=typeof win.getSelection){if(sel=win.getSelection(),sel.rangeCount>0){var r=win.getSelection().getRangeAt(0),pcr=r.cloneRange();pcr.selectNodeContents(element),start===!0?pcr.setStart(r.startContainer,r.startOffset):pcr.setEnd(r.endContainer,r.endOffset),spcr=pcr.toString()}}else if((sel=doc.selection)&&"Control"!=sel.type){var tr=sel.createRange(),ptr=doc.body.createTextRange();ptr.moveToElementText(element),start===!0?ptr.setEndPoint("StartToStart",tr):ptr.setEndPoint("EndToEnd",tr),spcr=ptr.text}return spcr.replace(/\r/g,"").length},getSelEl=function(start){if(document.selection){var r=document.selection.createRange();return r.collapse(start),r.parentElement()}var r,sel=window.getSelection();if(sel.getRangeAt?sel.rangeCount>0&&(r=sel.getRangeAt(0)):(r=document.createRange(),r.setStart(sel.anchorNode,sel.anchorOffset),r.setEnd(sel.focusNode,sel.focusOffset),r.collapsed!==sel.isCollapsed&&(r.setStart(sel.focusNode,sel.focusOffset),r.setEnd(sel.anchorNode,sel.anchorOffset))),r){var c=r[start?"startContainer":"endContainer"];return 3===c.nodeType?c.parentNode:c}return null},selectText=function(node,startPos,endPos,back){if(startPos<endPos&&startPos>=0&&window.getSelection){var isjq=node instanceof jQuery,element=isjq?node.get(0):node,jNode=isjq?node:$(node),doc=element.ownerDocument||element.document,win=doc.defaultView||doc.parentWindow,range=null,len=jNode.text().length,sel=win.getSelection(),doSel=function(c,start,end){if(1==c.nodeType){for(var cn=c.childNodes,cp=0,i=0;i<cn.length;i++){var chDone=doSel(cn[i],start-cp,end-cp);if(chDone==-1)return-1;cp+=chDone}return cp}if(3==c.nodeType){var l=c.nodeValue.length;if(null==range&&l>start&&(range=doc.createRange(),range.setStart(c,start)),null!=range&&l>=end){if(l==end?range.setEndAfter(c):range.setEnd(c,end),sel.addRange(range),back===!0){var r=range.cloneRange();r.collapse(!1),sel.removeAllRanges(),sel.addRange(r),sel.extend&&sel.extend(range.startContainer,range.startOffset)}return-1}return l}return 0};endPos>len&&(endPos=len),removeSelections(),doSel(element,startPos,endPos)}},xname=function(n){var i=n.indexOf(":"),r=i<1?n:n.substring(0,i),a=i<1||i==n.length-1?"a":n.substring(i+1);try{return $.parseXML("<"+r+" "+a+'=""/>'),!0}catch(e){}return!1},unresolveEnt=function(txt){var t=txt;try{t=$($.parseXML("<x>"+t+"</x>")).find("x").text()}catch(e){}return t},getPrefixes=function(s){for(var pr=[],inBr=!1,inQuDbl=!1,inQuSgl=!1,i=0;i<s.length;i++){var ch=s[i];if("<"==ch&&i<s.length-1&&"/"!=s[i+1]&&"!"!=s[i+1]&&"?"!=s[i+1])inBr=!0;else if(inBr&&">"==ch)inBr=!1;else if(inBr&&!inQuSgl&&'"'==ch)inQuDbl=!inQuDbl;else if(inBr&&!inQuDbl&&"'"==ch)inQuSgl=!inQuSgl;else if(inBr&&!inQuDbl&&!inQuSgl&&":"==ch)for(var p="",j=i-1;j>=0;j--){if('< \t\n\r="'.indexOf(s[j])!=-1){""!=p&&"xmlns"!=p&&"xml"!=p&&pr.indexOf(p)==-1&&pr.push(p);break}p=s[j]+p}}return pr},sepch=function(c){return" \n\t.:<>,_!;-+*^#?=()[]{}&%$ï¿½\"'\\~/|@".indexOf(c)!=-1},xmlToHtml=function(target,opt){var textArea,xml=opt.xml,xedit=opt.edit,charWidth=0,lineHeight=0,firstFocus=!0,inli=function(){return textArea},getSelBounds=function(){var start=getSelEl(!0),stop=getSelEl(!1);if(start==stop||null==start||null==stop)return null;var b={start:$(start),stop:$(stop)},tg1=b.start.closest(".sspxml"),tg2=b.stop.closest(".sspxml"),t0=target.get(0);return b.start.parent().hasClass("textnode")&&start.parentNode==stop.parentNode?null:1==tg1.length&&1==tg2.length&&tg1.get(0)==t0&&tg2.get(0)==t0?b:null},getPos=function(hn,e){var ho=hn.offset(),to=target.offset(),pos={x:ho.left-to.left+target.scrollLeft(),y:ho.top-to.top+target.scrollTop(),i:0,xoffset:0,yoffset:0};if(e){var clkX=e.pageX-to.left+target.scrollLeft()-pos.x,clkY=e.pageY-to.top+target.scrollTop()-pos.y,cnt=hn.text().length,v=hn.text();for(pos.i=1;pos.i<=cnt;pos.i++){var ch=v[pos.i-1];if("\n"==ch?(pos.xoffset=0,pos.yoffset+=lineHeight):pos.xoffset+=charWidth,pos.yoffset+lineHeight>=clkY){for(;pos.xoffset<clkX&&pos.i<cnt&&"\n"!=v[pos.i];)pos.xoffset+=charWidth,pos.i++;pos.xoffset-clkX>charWidth/2&&(pos.i--,pos.xoffset-=charWidth);break}}0==cnt&&(pos.i=0)}return pos},selec={dblclick:function(node,pos){var t=node.text(),s="";if(pos<t.length){var first=pos,last=pos;if(sepch(t[pos]))s=t[pos];else{for(var i=pos;i<t.length&&!sepch(t[i]);i++)last=i,s+=t[i];for(var i=pos-1;i>=0&&!sepch(t[i]);i--)first=i,s=t[i]+s}selec.create(node,s,first,last,0)}},tryRestore:function(s){var d=s.data("selec");d&&inliNewVal(s,d.org)},remove:function(s){s.off("blur").removeAttr("contenteditable spellcheck").off().removeAttr("style").find("span").removeAttr("style"),inli().show();var ret={valueOk:inliNewVal(s,s.text())};return s.removeData("selec"),ret.clonedNode=s.clone().insertBefore(s).click(inliEdit).mouseup(checkSel),s.remove(),ret},stop:function(s){var d=s.data("selec"),sp=getSelPos(s.get(0)),rem=selec.remove(s);rem.valueOk&&inliSet(rem.clonedNode,d.iStart>d.iStop&&d.org==rem.clonedNode.text()?d.iStop:sp)},replaceSelText:function(s,replText){var selPos=getSelPos(s.get(0));if(selPos>0){var selText=getSelectedText(),sl=selText.length,old=s.text(),newText=old.substring(0,selPos-sl)+replText+old.substring(selPos);inliNewVal(s,newText)}},keyUp:function(e){var s=$(this),d=s.data("selec"),k=e.which;if(d)if(d.init||k!=d.initKey){if($.inArray(k,[16,17,18,20])==-1){if(e.shiftKey&&$.inArray(k,cursorKeys)!=-1)return d.sl=getSelectedText().length,d.iStop=getSelPos(this),void(d.iStop-d.sl<d.iStart&&(d.iStop-=d.sl));(!e.ctrlKey||67!=k&&45!=k)&&selec.stop(s)}}else d.init=!0},keyDown:function(e){var s=$(this),k=e.which,ck=$.inArray(k,cursorKeys)!=-1;if(13==k)selec.replaceSelText(s,"\n"),e.preventDefault();else{if(85==k&&e.ctrlKey)return selec.replaceSelText(s,e.shiftKey?getSelectedText().toLocaleUpperCase():getSelectedText().toLocaleLowerCase()),!1;ck&&!e.shiftKey&&e.preventDefault()}},mouseDown:function(e){if(1==e.which){var hn=$(this),pos=getPos(hn,e);e.preventDefault();var rem=selec.remove(hn);inliSet(rem.clonedNode,pos.i)}},blur:function(){selec.remove($(this))},create:function(node,s,first,last,k){if(s.length>0&&first<=last){removeSelections(),inli().hide();var back=36==k||37==k||38==k,d={org:node.text(),sl:s.length,iStart:back?last+1:first,iStop:back?first:last+1,initKey:k,init:0==k,back:back},monitor=function(){var dd=node.data("selec");dd&&(node.text()==dd.org?setTimeout(monitor,200):selec.stop(node))};return node.attr("contenteditable","true").attr("spellcheck","false").data("selec",d),node.is(".block, .commentval, .cdataval")||(node.css("display","inline-block"),node.find("span").css("margin","0.01px")),selectText(node,first,last+1,back),node.on("keydown",selec.keyDown).on("keyup",selec.keyUp).on("blur",selec.blur).on("mousedown",selec.mouseDown).focus(),monitor(),!(back&&!window.getSelection().extend)}},start:function(node,pos,key,ctrl){ctrl!==!0&&(ctrl=!1);var t=node.text(),s="",endpos=pos;if(!(pos<0||pos>=t.length)){if(37!=key&&39!=key||ctrl&&!sepch(t[pos])){if(39==key&&ctrl||35==key)for(var i=pos;i<t.length;i++){var ch=t[i];if(i>pos&&39==key&&ctrl&&sepch(ch))break;if(35==key&&!ctrl&&"\n"==ch)break;s+=ch,endpos=i}else if(37==key&&ctrl||36==key)for(var i=pos;i>=0;i--){var ch=t[i];if(i<pos&&37==key&&ctrl&&sepch(ch))break;if(36==key&&!ctrl&&"\n"==ch)break;s=ch+s,endpos=i}else if(38==key){for(var i=pos-1;i>=0;i--)if(s=t[i]+s,"\n"==t[i]){var xofs=pos-1-i,cnt=0;endpos=i;for(var j=i-1;j>=0&&"\n"!=t[j];j--)s=t[i]+s,cnt++;cnt>xofs&&(endpos-=cnt-xofs);break}}else if(40==key){for(var xofs=0,i=pos-1;i>=0&&"\n"!=t[i];i--)xofs++;for(var i=pos;i<=t.length;i++)if(s+=t[i],"\n"==t[i]){endpos=i;for(var cnt=0,j=endpos+1;j<t.length&&"\n"!=t[j]&&cnt<xofs;j++)s+=t[j],cnt++;endpos+=cnt;break}}}else s=t[pos];var first=pos<=endpos?pos:endpos,last=pos<=endpos?endpos:pos;return selec.create(node,s,first,last,key)}}},updateInliPos=function(){if(textArea&&textArea.is(":visible")){var d=textArea.data("xedit");inliSet(d.hn,d.ipos)}},inliSet=function(hn,ipos){if(hn.hasClass("xbo")&&ipos>0)editNext(hn);else{var ta=inli().val(""),sl=target.scrollLeft(),dsc=5*charWidth,tw=target.width(),th=target.height(),st=target.scrollTop();if(0==hn.length)return void ta.hide();var d=ta.data("xedit"),pos=getPos(hn),left=pos.x,t=hn.text();d?(d.hn=hn,d.ipos=ipos):ta.data("xedit",{hn:hn,ipos:ipos,clktime:(new Date).getTime()}).show();for(var i=0;i<ipos;i++)"\n"==t[i]?(pos.y+=lineHeight,left=pos.x):left+=charWidth;ta.css("top",pos.y+"px").css("left",left+"px"),0==getSelectedText().length&&(ta.show(),ta.is(":visible")&&ta.focus()),left<80&&sl>0||left<sl?target.scrollLeft(left<80?0:left-dsc):left>sl+tw&&target.scrollLeft(left-tw+dsc),pos.y<st?target.scrollTop(pos.y<lineHeight?0:pos.y):pos.y+lineHeight>st+th&&target.scrollTop(pos.y-th+lineHeight)}},inliEdit=function(e){var hn=$(this),pos=getPos(hn,e),evalDelim=function(cl){var found=hn.hasClass(cl);if(found){var f=!hn.hasClass("start");hn=f?hn.prev():hn.next(),pos=getPos(hn),f&&(pos.i=hn.text().length)}return found};hn.is(".attsep, .xbi, .xbc")?pos.i=1:evalDelim("attquot")||evalDelim("commentmarkup")||evalDelim("pimarkup")||evalDelim("cdatamarkup");var d=inli().data("xedit"),clktime=(new Date).getTime(),secondOfDblClk=d&&d.hn.get(0)==this&&clktime-d.clktime<300&&!hn.is(".xbo, .xbi");return d&&(secondOfDblClk?selec.dblclick(hn,pos.i):d.clktime=clktime),firstFocus=!1,secondOfDblClk||inliSet(hn,pos.i),!1},checkTn=function(hn,v,delta){var xo=v.indexOf("<"),xc=v.indexOf(">"),rtn=hn.parent().hasClass("sspxml");if(xo!=-1){if(xc!=-1){var lastClose=v.lastIndexOf(">");if(xo>xc||v.lastIndexOf("<")>lastClose)return selec.tryRestore(hn),!1;try{for(var xx=v.substring(xo,lastClose+1),pr=getPrefixes(xx),xmlns="",isFrag="<?xml "!=xx.substring(0,6),i=0;i<pr.length;i++)xmlns+=" xmlns:"+pr[i]+'="w'+i+'"';var fr=isFrag?$.parseXML("<x"+xmlns+">"+xx+"</x>"):$.parseXML(xx),aft=$.trim(v.substring(lastClose+1)),bef=$.trim(v.substring(0,xo)),nl=isFrag?$(fr).find("x").get(0).childNodes:fr.childNodes,l=nl.length,lenPlist=l,nInsert=hn,frst=null;checkXmlSupported(fr),""!=aft&&(nCreate.textnode(unresolveEnt(aft),!1).insertAfter(hn).click(inliEdit).mouseup(checkSel),lenPlist++),""!=bef&&lenPlist++;for(var i=0;i<l;i++){var xn=nl[i],n=nCreate.xml(xn,lenPlist);if(null!=n){if(nInsert=eventize(n.insertAfter(nInsert)),1==xn.nodeType){var cps=nCreate.collapsible(xn,n);null!=cps&&cps.click(onExpandButton)}if(null==frst){var z=n.find(".xbo").first();1==z.length&&(frst=z)}}}""!=bef?inliNewVal(hn,bef):hn.remove(),null!=frst?inliSet(frst,0):inli().hide()}catch(e){selec.tryRestore(hn),console.log("sspxml: "+e.message)}return!1}if(xo!=v.lastIndexOf("<"))return selec.tryRestore(hn),!1;if("undefined"!=typeof delta&&xo<v.length-1){var f=v[xo+1],ff=xo<v.length-2?v[xo+2]:"_",splitTn=function(n,len,clk,mu,ipos){var aft=v.substring(xo+len),bef=v.substring(0,xo);""!=aft&&nCreate.textnode(unresolveEnt(aft),!1).insertAfter(hn).click(inliEdit).mouseup(checkSel),n.insertAfter(hn),n.find(clk).click(inliEdit),""!=bef?inliNewVal(hn,bef):hn.remove(),inliSet(n.find(mu).mouseup(checkSel).first(),ipos)};if(delta==f&&"!"!=f){if("?"==f)splitTn(nCreate.pi("",""),2,".pimarkup, .piname, .pival",".piname, .pival",0);else if(xname(f)){var elem=nCreate.element(f,null,null);splitTn(elem,2,".xbo, .xbi, .xbc, .elename, .attsep",".elename",1)}}else"!"!=f||delta!=ff||"-"!=ff&&"["!=ff||splitTn("-"==ff?nCreate.comment(""):nCreate.cdata(""),3,".xbo, .xbc, .commentval, .commentmarkup, .cdataval, .cdatamarkup",".commentval, .cdataval",0);if("<"!=delta&&("!"!=delta||delta!=f))return selec.tryRestore(hn),!1}}else if(xc!=-1)return selec.tryRestore(hn),!1;if(rtn&&0==v.length&&0==hn.siblings(".textnode").length)return inliNewVal(hn," "),inliSet(hn,0),!1;var oneLine=!rtn&&v.indexOf("\n")==-1&&v.length<=opt.maxOneLineLen&&0==hn.siblings(".node").length,b=hn.hasClass("block");return(oneLine&&b||!oneLine&&!b)&&hn.toggleClass("block"),!0},inliNewVal=function(hn,v,delta){var elemName=hn.hasClass("elename"),attVal=hn.hasClass("attval"),cdataval=hn.hasClass("cdataval"),hnParent=hn.parent(),attribName=hn.hasClass("attrib"),commentVal=hn.hasClass("commentval"),tnVal=hn.hasClass("textnode"),procInstName=hn.hasClass("piname"),xbo=hn.hasClass("xbo"),xbi=hn.hasClass("xbi"),xbc=hn.hasClass("xbc"),isTop=hn.parent().hasClass("sspxml"),isValid=function(){return(!attVal||v.indexOf('"')==-1&&v.indexOf("\t")==-1&&v.indexOf("\n")==-1&&v.indexOf("<")==-1&&v.indexOf(">")==-1)&&(!(((elemName||attribName)&&""!=v||procInstName)&&(!xname(v)||v!=$.trim(v)))&&(elemName&&hn.parent().find(">.elem.close").text(v),(!commentVal||v.indexOf("--")==-1)&&((!cdataval||v.indexOf("]]>")==-1)&&((!xbo||""==v||"<"==v[v.length-1])&&((!xbi||""!=v&&(">"==v[0]||"/>"==v)&&">"!=v)&&(!xbc||""!=v&&">"!=v&&">"==v[0]))))))},mkEmptyElem=function(hnXbi){var n=span("/>","emptyclose").insertBefore(hnXbi).click(inliEdit);hnXbi.nextAll().remove(),hnXbi.remove(),inliSet(n,2)};if(elemName&&"/"==delta&&/\/$/.test(v)){var n1=hn.next(),n2=n1.next(),n3=n2.next();if(n1.hasClass("attsep")&&n2.hasClass("xbi")&&"</"==n3.text())return mkEmptyElem(n2),!1}if(!isValid())return selec.tryRestore(hn),!1;if(attribName&&""==v){hn.next().remove(),hn.next().remove(),hn.next().remove(),hn.prev().remove();var s=hn.next();return hn.remove(),inliSet(s,1),!1}if(hn.hasClass("emptyclose")){if(">"==v){var nxbi=span(">","xbi"),nec=span(hnParent.find(".elename>.text").text(),"elem close"),nxbc=span(">","xbc");hn.remove(),hnParent.append(nxbi,txt("</"),nec,nxbc),nxbi.click(inliEdit),nec.click(inliEdit),nxbc.click(inliEdit),inliSet(nxbi,1)}else if("/>"==v.substring(0,2)&&v.length>2){var n=hnParent.next(),t=v.substring(2),nt=n.text(),iset=!1;n.hasClass("textnode")?iset=inliNewVal(n,t+nt,t):(n=nCreate.textnode("",!1).insertAfter(hnParent).click(inliEdit).mouseup(checkSel),iset=inliNewVal(n,t,t)),iset&&inliSet(n,t.length)}return!1}if(xbc){var n=hnParent.next(),t=v.substring(1),nt=n.text(),iset=!1;return n.hasClass("textnode")?iset=inliNewVal(n,t+nt,t):(n=nCreate.textnode("",!1).insertAfter(hnParent).click(inliEdit).mouseup(checkSel),iset=inliNewVal(n,t,t)),iset&&inliSet(n,t.length),!1}if(xbo){var xp=hnParent,collap=xp.hasClass("collapsible"),prev=xp.prev(),next=xp.next(),nextIsTN=next.hasClass("textnode");if(""==v){collap&&(prev.remove(),prev=xp.prev());var xpParent=xp.parent(),prevIsTN=prev.hasClass("textnode"),hasTN=prevIsTN||nextIsTN,nextEd=hasTN?null:getEditNode(xp,!0);if(hasTN||null!=nextEd||(nextEd=getEditNode(xp,!1)),xp.remove(),nextIsTN)if(prevIsTN){var pt=prev.text()+"\n",nt=next.text();next.remove(),inliNewVal(prev,pt+nt)&&inliSet(prev,pt.length)}else inliSet(next,0);else prevIsTN?inliSet(prev,prev.text().length):null!=nextEd&&inliSet(nextEd,0);nCreate.chkCollaps(xpParent)}else{var n=collap?prev.prev():prev,t=v.substring(0,v.length-1),iset=!1;n.hasClass("textnode")?iset=inliNewVal(n,n.text()+t,t):(n=nCreate.textnode("",!1).insertBefore(collap?xp.prev():xp).click(inliEdit).mouseup(checkSel),iset=inliNewVal(n,t,t)),iset&&inliSet(n,n.text().length)}return!1}if(xbi){var n=hn.next();if("/>"==v&&"</"==n.text())mkEmptyElem(hn);else{hn.parent().hasClass("collapsed")&&toggleExpand(hn.parent());var t=v.substring(1),nt=n.text(),iset=!1;n.hasClass("textnode")?iset=inliNewVal(n,t+nt,t):(n=nCreate.textnode("","</"==nt).insertAfter(hn).click(inliEdit).mouseup(checkSel),iset=inliNewVal(n,t,t)),iset&&inliSet(n,t.length)}return!1}if(tnVal&&!checkTn(hn,v,delta))return nCreate.chkCollaps(hnParent),isTop&&!target.children().last().hasClass("textnode")&&nCreate.textnode(" ",!1).appendTo(target).click(inliEdit).mouseup(checkSel),!1;if((commentVal||tnVal||cdataval)&&v.length>0&&"\n"==v[v.length-1]&&(v+=" "),tnVal&&""==v&&hn.prev().hasClass("xbi"))return inliSet(hn.prev(),1),hn.remove(),!1;if(attVal||tnVal){hn.empty();for(var tn="",inEnt=!1,add=function(){""!=tn&&(span(tn,inEnt?"xentity":"text").appendTo(hn),tn="")},i=0;i<v.length;i++){var c=v[i];"&"==c&&(add(),inEnt=!0),tn+=c,";"==c&&inEnt&&(add(),inEnt=!1)}add()}else hn.empty().append(span(v,"text"));return nCreate.chkCollaps(hn),!0},checkSel=function(){var selPos=getSelPos(this);if(selPos>0){var s=getSelectedText(),sl=s.length,n=$(this);selPos>=sl&&n.text().length>=selPos&&selec.create(n,s,selPos-sl,selPos-1,0)}},isTabStop=function(hn){return hn.is(".elename, .attrib, .xbo, .xbi, .xbc, .attsep, .attval, .commentval, .textnode, .cdataval, .piname, .pival, .emptyclose")},isFastStop=function(hn){return hn.is(".elename, .commentval, .textnode, .cdataval, .piname")},isContainer=function(hn){return hn.is(".node.elem, .node.comment, .node.pi, .node.cdata")},isVisi=function(hn){return 0==hn.closest(".collapsed").length},getEditNode=function(hn,forward){var nc=forward?hn.next():hn.prev();for(forward?nc.hasClass("xbi")&&nc.next().hasClass("textnode")&&(nc=nc.next()):hn.hasClass("textnode")&&nc.hasClass("xbi")&&(nc=nc.prev());!(1!=nc.length||isTabStop(nc)&&isVisi(nc));)nc=forward?isContainer(nc)&&isVisi(nc)?nc.children().first():nc.next():isContainer(nc)&&isVisi(nc)?nc.children().last():nc.prev();return 1==nc.length?nc:(nc=hn.parent(),1!=nc.length||nc.hasClass("sspxml")?null:getEditNode(nc,forward))},fastNext=function(hn){var n=getEditNode(hn,!0),ok=null!=n;if(ok){if(!isFastStop(n))return fastNext(n);inliSet(n,0)}return ok},fastPrev=function(hn){var n=getEditNode(hn,!1),ok=null!=n;if(ok){if(!isFastStop(n))return fastPrev(n);inliSet(n,n.hasClass("xbo")?0:n.text().length)}return ok},editNext=function(hn){var n=getEditNode(hn,!0),ok=null!=n;return ok&&inliSet(n,n.is(".attsep, .xbi, .xbc")?1:0),ok},editPrev=function(hn){var n=getEditNode(hn,!1),ok=null!=n;return ok&&inliSet(n,n.hasClass("xbo")?0:n.text().length),ok},insertAtt=function(hn,name,val){var s=tspan(name,"attrib").insertAfter(span(" ","attsep").insertBefore(hn).click(inliEdit)).click(inliEdit).mouseup(checkSel),attval=span("","attval");return span('"',"attquot").insertAfter(attval.insertAfter(span('="',"attquot start").insertAfter(s).click(inliEdit)).click(inliEdit)).click(inliEdit),resEnt(attval.mouseup(checkSel),val),s},inliChange=function(){var ta=$(this),v=ta.val(),d=ta.val("").data("xedit"),t=d.hn.text(),last=d.ipos>=t.length,newVal=0==d.ipos?v+t:last?t+v:t.substring(0,d.ipos)+v+t.substring(d.ipos);if(d.hn.hasClass("attsep")){if(xname(v))inliSet(insertAtt(d.hn,v,""),v.length);else if(v.indexOf("<")==-1&&v.indexOf(">")==-1){for(var pr=getPrefixes("<x "+v+"/>"),xmlns="",i=0;i<pr.length;i++)xmlns+=" xmlns:"+pr[i]+'="w'+i+'"';try{var atts=$($.parseXML("<x"+xmlns+"><y "+v+"/></x>")).find("x>y").get(0).attributes;if(null!=atts){for(var a=0;a<atts.length;a++)insertAtt(d.hn,atts[a].nodeName,atts[a].value);inliSet(d.hn,1)}}catch(e){console.log("sspxml: "+e.message)}}}else last&&" "==v&&d.hn.is(".elename, .piname")?editNext(d.hn):last&&"="==v&&d.hn.hasClass("attrib")?editNext(d.hn):inliNewVal(d.hn,newVal,v)&&inliSet(d.hn,d.ipos+v.length)},inliKeyDown=function(e){if(33==e.which||34==e.which)return void e.preventDefault();var ta=$(this),d=ta.data("xedit"),t=d.hn.text(),k=e.which;if(e.shiftKey&&$.inArray(k,cursorKeys)!=-1){var prevDef=!0;if(!d.hn.is(".xbo, .xbi, .xbc")){var start=k>35&&k<39?d.ipos-1:d.ipos;prevDef=selec.start(d.hn,start,k,e.ctrlKey)}return void(prevDef&&e.preventDefault())}if(9==e.which){var old=d.hn.get(0);e.shiftKey?editPrev(d.hn):editNext(d.hn),old!=d.hn.get(0)&&e.preventDefault()}else if(e.ctrlKey&&77==e.which&&d.hn.hasClass("elename")&&document.createRange&&window.getSelection){var elNode=d.hn.closest(".node.elem").get(0),doc=elNode.ownerDocument||elNode.document,win=doc.defaultView||doc.parentWindow,r=doc.createRange(),sel=win.getSelection();return target.focus(),r.selectNodeContents(elNode),sel.removeAllRanges(),sel.addRange(r),target.focus(),!1}if($.inArray(k,[8,13,35,36,37,38,39,40,46])!=-1){if(13==k&&d.hn.is(".commentval, .textnode, .cdataval, .xbi, .xbo, .xbc"))return;if(e.preventDefault(),d.hn.hasClass("attsep"))return void(37==k?editPrev(d.hn):38==k?fastPrev(d.hn):39==k?editNext(d.hn):40==k&&fastNext(d.hn));if(37==k||8==k)if(d.ipos>0){var np=d.ipos-1;if(8==k){var r=t.substring(d.ipos),newVal=1==d.ipos?r:t.substring(0,d.ipos-1)+r;if(!inliNewVal(d.hn,newVal))return}else if(e.ctrlKey)for(var i=d.ipos-1;i>=0;i--){var si=sepch(t[i]),sp=sepch(t[np]);if(i<d.ipos-1&&(si&&t[i]!=t[np]||!si&&sp))break;np=i}inliSet(d.hn,np)}else editPrev(d.hn);else if(!d.hn.hasClass("xbo")||39!=k&&35!=k)if(!d.hn.hasClass("xbi")||37!=k&&36!=k){if(39==k)if(d.ipos<t.length){var np=d.ipos;if(e.ctrlKey)for(var i=d.ipos;i<t.length;i++){var si=sepch(t[i]),sp=sepch(t[np]);if(i>d.ipos&&(si&&t[i]!=t[np]||!si&&sp))break;np=i}inliSet(d.hn,np+1)}else editNext(d.hn);else if(46==k){if(d.ipos<t.length){var r=t.substring(d.ipos+1),newVal=0==d.ipos?t.substring(1):t.substring(0,d.ipos)+r;inliNewVal(d.hn,newVal),inliSet(d.hn,d.ipos)}else if(d.hn.hasClass("xbi")){var n=d.hn.next();n.hasClass("textnode")&&(inliNewVal(n,n.text().substring(1)),inliSet(n,0))}}else if(36==k&&d.ipos>0){if(e.ctrlKey)d.ipos=0;else for(var i=d.ipos-1;i>=0&&"\n"!=t[i];i--)d.ipos--;inliSet(d.hn,d.ipos)}else if(35==k&&d.ipos<t.length){if(e.ctrlKey)d.ipos=t.length;else for(var i=d.ipos;i<t.length&&"\n"!=t[i];i++)d.ipos++;inliSet(d.hn,d.ipos)}else if(38==k){var done=!1;if(d.ipos>0)for(var i=d.ipos-1;i>=0;i--)if("\n"==t[i]){var xofs=d.ipos-1-i,cnt=0;d.ipos=i,done=!0;for(var j=i-1;j>=0&&"\n"!=t[j];j--)cnt++;cnt>xofs&&(d.ipos-=cnt-xofs),inliSet(d.hn,d.ipos);break}done||fastPrev(d.hn)}else if(40==k){var done=!1;if(d.ipos<=t.length){for(var xofs=0,i=d.ipos-1;i>=0&&"\n"!=t[i];i--)xofs++;for(var i=d.ipos;i<t.length;i++)if("\n"==t[i]){d.ipos=i,done=!0;for(var cnt=0,j=d.ipos+1;j<t.length&&"\n"!=t[j]&&cnt<xofs;j++)cnt++;inliSet(d.hn,d.ipos+cnt+1);break}}done||fastNext(d.hn)}}else editPrev(d.hn);else editNext(d.hn)}},eventize=function(n){return n.find(".expandbutton").click(onExpandButton),xedit&&(n.find(slktr.clk).click(inliEdit),n.find(slktr.mu).mouseup(checkSel)),n},deleteSel=function(){if(0!=$.trim(getSelectedText()).length){var b=getSelBounds();if(null==b){var s1=getSelEl(!0);if(s1==getSelEl(!1))if(s1==target.get(0))inli().nextAll().remove(),target.append(nCreate.textnode(" ",!1)),setFirstEdit();else{var n=$(s1);n.is(".node.elem")&&(n.hasClass("collapsible")&&n.prev().remove(),n.remove(),setFirstEdit())}}else{b.start.hasClass("attsep")&&(b.start=b.start.next().find(".text")),b.stop.hasClass("attsep")&&(b.stop=b.stop.prev());var b1p=b.start.parent(),b2p=b.stop.parent(),startIsText=b.start.hasClass("text")&&!b1p.is(".attval, .attrib"),stopIsText=b.stop.hasClass("text")&&!b2p.is(".attval, .attrib"),attribs=b1p.hasClass("attrib")&&getSelPos(b.start.get(0),!0)==b.start.text().length&&b.stop.hasClass("attquot")&&!b.stop.hasClass("start");if(attribs||(b.start.is(".xbo")||startIsText)&&(b.stop.is(".xbc, .emptyclose")||stopIsText))try{for(var xx=getSelectedText(),pr=getPrefixes(xx),xmlns="",i=0;i<pr.length;i++)xmlns+=" xmlns:"+pr[i]+'="w'+i+'"';attribs?$.parseXML("<x"+xmlns+"><y "+xx+"/></x>"):$.parseXML("<x"+xmlns+">"+xx+"</x>");var newStartTnVal,startEl=b1p,stopEl=attribs?b.stop:b2p,cur=startEl,fin=!1;if(editPrev(isTabStop(b.start)?b.start:startEl),startIsText){var selPos=getSelPos(startEl.get(0),!0),s=startEl.text(),sl=s.length;selPos==sl?startIsText=!1:newStartTnVal=s.substring(0,sl-selPos)}if(stopIsText){var selPos=getSelPos(stopEl.get(0)),s=stopEl.text();selPos==s.length?stopIsText=!1:inliNewVal(stopEl,s.substring(selPos))}startIsText&&inliNewVal(startEl,newStartTnVal),cur.hasClass("collapsible")&&cur.prev().remove();for(var first=!0;;){var fin=cur.get(0)==stopEl.get(0),n=cur.next();if(fin&&stopIsText||first&&startIsText||cur.remove(),fin){attribs&&n.hasClass("attsep")&&n.remove();break}first=!1,cur=n}if(startIsText){var next=startEl.next(),s=startEl.text();next.hasClass("textnode")&&(inliNewVal(startEl,s+next.text()),next.remove()),inliSet(startEl,s.length)}else if(stopIsText){var prev=stopEl.prev();if(prev.hasClass("textnode")){var s=prev.text();inliNewVal(prev,s+stopEl.text()),stopEl.remove(),inliSet(prev,s.length)}else inliSet(stopEl,0)}var d=inli().data("xedit");return d&&(nCreate.chkCollaps(d.hn),inli().focus()),!1}catch(e){}}}},targetCopy=function(e){var comments=target.find("span.commentmarkup.start, span.xbo.commentxbo");comments.css("position","static"),setTimeout(function(){comments.css("position","")},0)},targetKeyDown=function(e){var cur=target.scrollTop(),h=target.height();if(33==e.which){var n=cur-h;return n<0&&(n=0),target.scrollTop(n),!1}if(34==e.which)return target.scrollTop(cur+h),!1;if(46!=e.which&&8!=e.which||deleteSel(),e.ctrlKey){if(65==e.which&&document.createRange&&window.getSelection){var t=this,doc=t.ownerDocument||t.document,win=doc.defaultView||doc.parentWindow,r=doc.createRange(),sel=win.getSelection(),doSelect=function(){r.selectNodeContents(t),sel.removeAllRanges(),sel.addRange(r)};return target.scrollTop(0),xedit?(target.focus(),doSelect(),target.focus()):doSelect(),!1}if(xedit&&88==e.which&&0==target.find("span[contenteditable]").length){try{document.execCommand("copy"),deleteSel()}catch(e){}return!1}}},setFirstEdit=function(){var n=target.children().first();isTabStop(n)||(n=getEditNode(n,!0)),inliSet(n,0)},inliBind=function(){textArea.on("input propertychange",inliChange).keydown(inliKeyDown).click(function(){var d=$(this).data("xedit");return d&&$(":focus").get(0)==this&&(new Date).getTime()-d.clktime<300&&!d.hn.is(".xbo, .xbi")&&selec.dblclick(d.hn,d.ipos),!1})},nCreate={mkCollaps:function(hn){return hn.addClass("collapsible"),$("<div/>").addClass("expandbutton button-collapse").insertBefore(hn)},chkCollaps:function(hn){var p=hn.hasClass("node")&&hn.hasClass("elem")?hn:hn.closest(".node.elem");if(1==p.length){var children=p.find(">.node"),cl=children.length,exp=cl>0,isexp=p.hasClass("collapsible");if(1==cl&&children.hasClass("textnode")){var v=children.text();exp=v.indexOf("\n")!=-1||v.length>opt.maxOneLineLen}exp&&!isexp?nCreate.mkCollaps(p).click(onExpandButton):!exp&&isexp&&(p.removeClass("collapsible"),p.prev().remove())}},collapsible:function(n,hn){var chl=n.childNodes.length,ret=null;return chl>0&&!(1==chl&&3==n.childNodes[0].nodeType&&$.trim(n.childNodes[0].nodeValue).length<=opt.maxOneLineLen)&&(ret=nCreate.mkCollaps(hn)),ret},element:function(nn,cn,atts){var d=$("<div/>").addClass("node elem").append(span("<","xbo"),tspan(nn,"elem elename"));if(opt.cssElement&&opt.cssElement(d,nn),null!=atts)for(var a=0;a<atts.length;a++)d.append(span(" ","attsep"),tspan(atts[a].nodeName,"attrib"),span('="',"attquot start")),resEnt($("<span/>").addClass("attval").appendTo(d),atts[a].value),d.append(span('"',"attquot"));return xedit&&d.append(span(" ","attsep")),null!=cn&&0==cn.length?d.append(span("/>","emptyclose")):(d.append(span(">","xbi")),null!=cn&&appendNodeList(d,cn),d.append(txt("</"),span(nn,"elem close"),span(">","xbc"))),d},comment:function(nv){return $("<div/>").addClass("node comment").append(span("<","xbo commentxbo"),span("!--","commentmarkup start"),tspan(nv,"commentval"),span("--","commentmarkup"),span(">","xbc"))},pi:function(nn,nv){return $("<div/>").addClass("node pi").append(span("<","xbo"),span("?","pimarkup start"),span(nn,"piname"),txt(" "),tspan(nv,"pival"),span("?","pimarkup"),span(">","xbc"))},cdata:function(nv){return $("<div/>").addClass("node cdata").append(span("<","xbo"),span("![CDATA[","cdatamarkup start"),tspan(nv,"cdataval"),span("]]","cdatamarkup"),span(">","xbc"))},textnode:function(nv,isOnlyChild){nv=nv.replace(rexLeadWhiteSpace," ").replace(rexTrailWhiteSpace," ");var oneLine=isOnlyChild&&nv.length<=opt.maxOneLineLen&&nv.indexOf("\n")==-1,q=$("<span/>").addClass("node textnode");return oneLine||q.addClass("block"),resEnt(q,nv)},xml:function(n,lenParList){var nt=n.nodeType,nn=n.nodeName,nv=n.nodeValue;if(1==nt)return nCreate.element(nn,n.childNodes,n.attributes);if(3==nt)return rexOnlyWhiteSpace.test(nv)?null:nCreate.textnode(nv,1==lenParList);if(8==nt)return nCreate.comment(nv);if(4==nt)return nCreate.cdata(nv);if(7==nt)return nCreate.pi(nn,nv);throw new Error("sspxml: node type "+nt+" is not supported!")}},appendNode=function(p,n,lenParList){var hn=nCreate.xml(n,lenParList);null!=hn&&(p.append(hn),1==n.nodeType&&nCreate.collapsible(n,hn))},appendNodeList=function(p,nl){for(var l=nl.length,i=0;i<l;i++)appendNode(p,nl[i],l);
},getCommentCss=function(){return".sspxml span.commentval{margin-left:"+4*charWidth+"px}\n.sspxml span.commentmarkup.start{margin-left:"+charWidth+"px}"},computeMetrics=function(){var testDiv=$("<div/>").appendTo($("body")).addClass("sspxml"),temp=$("<span/>").appendTo(testDiv).text("MMMMMMMMMMMMMMMMMMMM\nM\nM\nM\nM\nM\nM\nM\nM\nM\nM\nM\nM\nM\nM\nM\nM\nM\nM\nM");charWidth=temp.width()/20,lineHeight=temp.height()/20,testDiv.remove(),$("body").data("sspxml-metrics",{charWidth:charWidth,lineHeight:lineHeight,zoom:zoom}),updateInliPos()},zoom=window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDP,dynCss=$("style#sspxml-dyn-css"),firstEditWhenFF=function(){firstFocus&&(firstFocus=!1,setFirstEdit())};if($(window).resize(function(e){if(e.target==window){var z=window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDP;Math.abs(zoom-z)>.03&&(zoom=z,computeMetrics(),dynCss.text(getCommentCss()))}}),0==dynCss.length){var head=$("html>head");0==head.length&&(head=$("<head/>").insertBefore($("html>body"))),$("<style/>").appendTo(head).text(".sspxmlwaitcursor {cursor:wait} .sspxml-holder{ position:relative; background-color:#fff; border: 2px solid #888; border-bottom-color:transparent; border-right-color:transparent; box-sizing: border-box } .sspxml {background-color:#fff; white-space:pre; font-family: Consolas, Courier New, Courier, Terminal, Ubuntu Mono, monospace; margin: 0; padding: 0; font-size:14px; overflow:auto; position:absolute; bottom:0; top:0; left:0; right:0;outline:none; } .sspxml div.node {border-left:1px solid transparent; margin-left:17px;  color:#00f} .sspxml div.collapsible.elem {border-left:1px solid #c8c8c8;border-radius:10px; margin-top: -19px} .sspxml div.collapsed.elem {height: 19px; overflow:hidden; border-radius:0px; border-left:1px solid transparent} .sspxml .expandbutton{color:#888; width:15px; text-align:right; margin-top:3px; cursor:pointer; height:16px} .sspxml .expandbutton.button-expand {background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wUTEDIgb8ikkgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAABEElEQVQ4y+3UsUoEMRDG8Z+6IIhwaKGVWhxY2tnYqLXINYKt4BMINoK9hcJZ+gK+gQ+grVaCWHkodjbCNsoV59nkIKzrmhUbxYGQ2Un478x8SfhtNlQSm8Y+VjCWwLjCAa6rwKM4xRTaeE0Ab2EB6+h8tmkpLDZLKpsPoyyZc2zHwaywaVB6pwS8Gvw79KO1LvJiMlkNLeYqdPlgWQ2he3VORRV4EuPBH0Ej+LPRT7p4qgvexWb0PRHmtSh2g1Zd8BFOoox3gt+OMu59pxXPYQzAefAfU/pdR7zhnxKvaDneCmc4GfwS5mbhkvRxUQFu4P6rt+Is9PA4sZIWlrGB26rXbQaHWEwEP2APl/7tb9g7UKku5k9E5d8AAAAASUVORK5CYII=);                                     background-repeat: no-repeat;background-size: cover} .sspxml .expandbutton.button-collapse {background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wUTECsiGsZspgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAA0klEQVQ4y+3UMUtCYRTG8V8SXIhAaKjJyd2tpckvEHdsDfoKLYG7g4EuQl+g79HiYjgIrVdbW4KWokFwuYJI3fu+gqLRAy8vnHP4c85z4LBvOvghdoYWmjgKYDyjjXEROMEjTtHFVwD4Gg1cIvut6CJP1iOmTvCEm+VgZaVoMXoWAf7Gx2ozlU0tb2Pgw4LcCY4DbHiLBd/iqgT8gjQWfI+HEvBsHSve87dby9sa+DP/65GcKqZFHo8wQR+9QGia35ZB2XWroYPzQPAr7jD0r7+hOcMLHWifZEjQAAAAAElFTkSuQmCC);                                  background-repeat: no-repeat;background-size: cover} .sspxml div.elem:first-child {margin:0 0 10px 10px } .sspxml div.comment {color:#348063; position:relative} .sspxml span.textnode {margin-left:1px; margin-right:1px; color:#000} .sspxml span.textnode.block {display:block; margin: 0 0 0 20px; min-height:1em} .sspxml span.textnode span.textnode.block {display:inline; margin: 0; min-height:1px} .sspxml span.attrib {color:#f00} .sspxml span.namespace {margin-left:85px} .sspxml span.elem {color:#af3315} .sspxml span.piname {color:#af3315} .sspxml span.pival {color:#666} .sspxml span.cdataval {color:#446; display:block;margin-left:20px; min-height:1em} .sspxml span.commentval {display:inline-block} .sspxml span.commentmarkup.start, .sspxml span.xbo.commentxbo {top:0; position:absolute} .sspxml span.xentity {color:#f00 } .sspxml span.attval {color:#00f} .sspxml span.attsep {display:inline-block; width:14px} .sspxml textarea.inli {resize:none; font-family:inherit; font-size:inherit; padding: 0px 1px; margin: 0px -1px; outline:none; border:none; min-height:1px; min-width:1px; vertical-align:top; position:absolute; height:1em; width:6px; overflow:hidden;background:none } .sspxml span[contenteditable] { outline: 0px solid transparent }"),computeMetrics(),$("<style/>").attr("id","sspxml-dyn-css").appendTo(head).text(getCommentCss())}else{var metrics=$("body").data("sspxml-metrics");Math.abs(metrics.zoom-zoom)<.03?(charWidth=metrics.charWidth,lineHeight=metrics.lineHeight):(computeMetrics(),dynCss.text(getCommentCss()))}xedit&&(textArea=$('<textarea spellcheck="false"/>').attr("tabindex",opt.tabIndex).addClass("inli").appendTo(target).focus(firstEditWhenFF),inliBind());var frag=document.createDocumentFragment(),jf=$(frag);9==xml.nodeType||11==xml.nodeType||opt.childrenOnly===!0?appendNodeList(jf,xml.childNodes):appendNode(jf,xml,1),xedit&&jf.append(nCreate.textnode(" ",!1)),target.get(0).appendChild(frag),eventize(target).keydown(targetKeyDown).on("copy",targetCopy),xedit&&document.body.createTextRange&&$("body").keydown(function(e){46!=e.which&&8!=e.which||getSelEl(!0)!=target.get(0)||deleteSel()}),xedit&&target.click(function(e){var to=target.offset(),clkX=e.pageX-to.left+target.scrollLeft(),clkY=e.pageY-to.top+target.scrollTop(),findVert=function(parent){var result=parent;return parent.find(">*").each(function(){var t=$(this);if(!t.hasClass("inli")){var pos=getPos(t);if(pos.y>clkY)return!1;result=findVert(t)}}),result},elem=findVert(target);if(target.get(0)==elem.get(0))setFirstEdit();else{for(var t=elem,p1=getPos(t),st=!1;t=t.prev(),0!=t.length;){var pos=getPos(t);if(clkX>pos.x+t.width()||pos.y<p1.y)break;elem=t,st=!0}var ok=elem.is(slktr.clk);ok?inliSet(elem,st?0:elem.text().length):ok=st?editNext(elem):editPrev(elem),ok||setFirstEdit()}})},methods={init:function(opt){try{$("body").addClass("sspxmlwaitcursor");var settings={childrenOnly:!1,edit:!1,maxOneLineLen:40,tabIndex:0,initOk:!1};opt&&($.extend(settings,opt),opt.xml&&!$.isXMLDoc(opt.xml)&&(settings.xml=$.parseXML(opt.xml)));var targetTabIndex=settings.edit?-1:settings.tabIndex;return this.each(function(){if(!opt||!opt.xml){var inner=$(this).text();inner.length>0&&(settings.xml=$.parseXML(inner))}var holder=$(this).addClass("sspxml-holder").data(piName,settings).empty().scrollTop(0).scrollLeft(0),t=$("<div/>").attr("tabindex",targetTabIndex).addClass("sspxml").appendTo(holder);if(!settings.xml)throw new Error("sspxml: called init without xml data!");checkXmlSupported(settings.xml),xmlToHtml(t,settings),settings.initOk=!0})}finally{$("body").removeClass("sspxmlwaitcursor")}},get:function(opt){if(1!=this.length)throw new Error("sspxml: get() must be called on a single instance!");var settings=this.data(piName);if(!settings||!settings.initOk)throw new Error("sspxml: called get() before successfull init!");var t=$.trim(this.find(".sspxml").text());if(opt){if(opt.root&&(t="<"+opt.root+">"+t+"</"+opt.root+">"),opt.asDocument===!0)return $.parseXML(t);if(opt.formatted===!0){var doc=$.parseXML(t),d=doc,co=opt.childrenOnly===!0;return co&&(d=doc.documentElement),formatXml(d,co)}if(opt.sepTextNodes===!0){var sep=opt.hasOwnProperty("separator")?opt.separator:"|",includeCDATA=opt.includeCDATA===!0;return getSepTextNodes($.parseXML(t).documentElement,sep,includeCDATA)}}return t}};$.fn[piName]=function(){var m=arguments[0];if(methods[m])return methods[m].apply(this,Array.prototype.slice.call(arguments,1));if("object"!=typeof m&&m)throw new Error('method "'+m+'" does not exist on jQuery.'+piName);return methods.init.apply(this,arguments)},$[piName]={xmlChar:xmlChar,formatXml:formatXml,checkXmlSupported:checkXmlSupported,getSepTextNodes:getSepTextNodes}}(jQuery,"sspxml");